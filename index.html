<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description"
        content="Serendipity Casa Vacanze a Torino, nel cuore di Santa Rita. Un'oasi di comfort e design per un soggiorno indimenticabile." />
    <title>Serendipity Casa Vacanze Torino</title>
    <link rel="icon" type="image/png" href="IMAGES/favicon.png">
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>



    <!-- --- Hero Section --- -->
    <header class="hero-section hero-updated">
        <div class="nav-overlay"></div>
        <nav class="main-nav">
            <div class="logo"><a href="index.html"><img src="IMAGES/logo_serendipity.png" alt="Serendipity Logo"></a>
            </div>
            <ul class="nav-links">
                <li><a href="index.html">HOME</a></li>
                <li><a href="explore.html">EXPLORE</a></li>
            </ul>
            <!-- --- Language Selector (Moved here for Mobile Stacking) --- -->
            <div class="language-selector">
                <button id="lang-it" class="active">IT</button>
                <button id="lang-en">EN</button>
            </div>
            <div class="hamburger">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </nav>
        <div class="hero-content">
            <h1>Serendipity</h1>
            <h2><span data-lang="it">Casa Vacanze</span><span data-lang="en">Holiday Home</span></h2>
            <p style="font-size: 0.9rem; margin-top: -10px; opacity: 0.9;">CIR: 00127209054 | CIN: IT001272C28EJX3D2Q
            </p>
            <p><span data-lang="it">Via Mombarcaro 47, 10136 Torino</span><span data-lang="en">Via Mombarcaro 47, 10136
                    Turin</span></p>
            <a href="#booking" class="cta-button hero-cta-button cta-button-red"><span data-lang="it">VERIFICA
                    DISPONIBILITÀ</span><span data-lang="en">CHECK AVAILABILITY</span></a>
        </div>
        <a href="#intro" class="scroll-down">
            <span data-lang="it">&#8595;</span>
            <span data-lang="en">&#8595;</span>
            <span class="scroll-text">
                <span data-lang="it">Scorri per scoprire</span>
                <span data-lang="en">Scroll to discover</span>
            </span>
        </a>
    </header>

    <main>
        <!-- --- Intro Section --- -->
        <section id="intro" class="content-section">
            <div class="container">
                <h2 class="section-title">
                    <span data-lang="it">Benvenuti a Serendipity</span>
                    <span data-lang="en">Welcome to Serendipity</span>
                </h2>
                <p class="intro-text">
                    <span data-lang="it">
                        Serendipity è nata quasi per caso, con il desiderio profondo di omaggiare e ringraziare le
                        persone che, inaspettatamente, hanno reso speciale un periodo particolare della nostra vita. È
                        con lo stesso
                        spirito che accogliamo ogni ospite: con cura, gratitudine e attenzione, perché il soggiorno sia
                        davvero indimenticabile.
                    </span>
                    <span data-lang="en">
                        Serendipity was born almost by chance, with the heartfelt desire to honour and thank the people
                        who unexpectedly made a year of our life truly special. With the same spirit, we welcome every
                        guest—with care, gratitude, and attention—so that their stay becomes equally unforgettable.
                    </span>
                </p>
                <p class="intro-text">
                    <span data-lang="it">
                        Il nostro bilocale, accogliente e ben attrezzato, si trova al 2° piano (senza ascensore) di una
                        piccola palazzina nel cuore del vivace quartiere Santa Rita, a pochi passi da numerosi servizi.
                        L’intero appartamento è a vostra disposizione, con una camera da letto matrimoniale e un comodo
                        divano letto in soggiorno, per offrirvi il massimo comfort.
                    </span>
                    <span data-lang="en">
                        Our cosy and well-equipped one-bedroom apartment is located on the 2nd floor (no elevator) of a
                        small building in the lively Santa Rita district, just a short walk from many local amenities.
                        The entire flat is at your disposal, featuring a double bedroom and a comfortable sofa bed in
                        the living room, to ensure you enjoy maximum comfort during your stay.
                    </span>
                </p>
            </div>
        </section>

        <!-- --- Amenities Section --- -->
        <section id="amenities" class="content-section" style="background-color: var(--light-gray);">
            <div class="container">
                <h2 class="section-title">
                    <span data-lang="it">Comfort e Dotazioni</span>
                    <span data-lang="en">Comfort & Amenities</span>
                </h2>
                <div class="grid">
                    <div class="card">
                        <h3>
                            <span data-lang="it">Generale</span>
                            <span data-lang="en">General</span>
                        </h3>
                        <ul>
                            <li><span data-lang="it">Porta blindata</span><span data-lang="en">Reinforced door</span>
                            </li>
                            <li><span data-lang="it">Connessione Wi-Fi gratuita in tutta la struttura</span><span
                                    data-lang="en">Free Wi-Fi throughout the apartment</span></li>
                            <li><span data-lang="it">Struttura anallergica, non fumatori</span><span
                                    data-lang="en">Hypoallergenic environment, non-smoking</span></li>
                            <li><span data-lang="it">Riscaldamento, pavimenti in gres</span><span
                                    data-lang="en">Heating, tiled floors</span></li>
                            <li><span data-lang="it">Estintore, Rilevatore gas</span><span data-lang="en">Fire
                                    extinguisher, Gas detector</span></li>
                        </ul>
                    </div>
                    <div class="card">
                        <h3>
                            <span data-lang="it">Cucina</span>
                            <span data-lang="en">Kitchen</span>
                        </h3>
                        <ul>
                            <li><span data-lang="it">Cucina a induzione attrezzata con microonde, frigorifero,
                                    lavastoviglie</span><span data-lang="en">Induction kitchen with microwave, fridge,
                                    dishwasher</span></li>
                            <li><span data-lang="it">Macchina da caffè con cialde</span><span data-lang="en">Coffee
                                    machine with pods</span></li>
                            <li><span data-lang="it">Lavatrice</span><span data-lang="en">Washing machine</span></li>
                        </ul>
                    </div>
                    <div class="card">
                        <h3>
                            <span data-lang="it">Zona Notte & Bagno</span>
                            <span data-lang="en">Sleeping Area & Bathroom</span>
                        </h3>
                        <ul>
                            <li><span data-lang="it">TV a schermo piatto</span><span data-lang="en">Flat-screen
                                    TV</span></li>
                            <li><span data-lang="it">Divano letto 1 piazza e mezza</span><span data-lang="en">Small
                                    double sofa
                                    bed</span></li>
                            <li><span data-lang="it">Letto matrimoniale con biancheria inclusa</span><span
                                    data-lang="en">Double bed with linens included</span></li>
                            <li><span data-lang="it">Bagno con doccia, bidet, asciugamani, asciugacapelli</span><span
                                    data-lang="en">Bathroom with shower, bidet, towels, hairdryer</span></li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- --- Gallery Section --- -->
        <section id="gallery" class="content-section">
            <div class="container">
                <h2 class="section-title">
                    <span data-lang="it">Galleria</span>
                    <span data-lang="en">Gallery</span>
                </h2>
                <div class="gallery-grid">
                    <!-- 9 Selected Images for Grid (User Requested) -->
                    <div class="gallery-item"><img src="IMAGES/ingresso_09.webp" alt="Dettaglio ingresso"
                            onclick="openLightbox(1)" tabindex="0"
                            onkeypress="if(event.key === 'Enter') openLightbox(1)"></div>
                    <div class="gallery-item"><img src="IMAGES/camera_letto_03.webp" alt="Camera da letto"
                            onclick="openLightbox(2)" tabindex="0"
                            onkeypress="if(event.key === 'Enter') openLightbox(2)"></div>
                    <div class="gallery-item"><img src="IMAGES/bagno_04.webp" alt="Dettaglio doccia"
                            onclick="openLightbox(3)" tabindex="0"
                            onkeypress="if(event.key === 'Enter') openLightbox(3)"></div>
                    <div class="gallery-item"><img src="IMAGES/bagno_01.webp" alt="Bagno moderno"
                            onclick="openLightbox(4)" tabindex="0"
                            onkeypress="if(event.key === 'Enter') openLightbox(4)"></div>
                    <div class="gallery-item"><img src="IMAGES/soggiorno_03.webp" alt="Area living"
                            onclick="openLightbox(5)" tabindex="0"
                            onkeypress="if(event.key === 'Enter') openLightbox(5)"></div>
                    <div class="gallery-item"><img src="IMAGES/camera_letto_06.webp" alt="Camera da letto"
                            onclick="openLightbox(6)" tabindex="0"
                            onkeypress="if(event.key === 'Enter') openLightbox(6)"></div>
                    <div class="gallery-item"><img src="IMAGES/soggiorno_04.webp" alt="Dettaglio soggiorno"
                            onclick="openLightbox(7)" tabindex="0"
                            onkeypress="if(event.key === 'Enter') openLightbox(7)"></div>
                    <div class="gallery-item"><img src="IMAGES/soggiorno_07.webp" alt="Arredamento soggiorno"
                            onclick="openLightbox(8)" tabindex="0"
                            onkeypress="if(event.key === 'Enter') openLightbox(8)"></div>
                    <div class="gallery-item"><img src="IMAGES/ingresso_02.webp" alt="Ingresso"
                            onclick="openLightbox(9)" tabindex="0"
                            onkeypress="if(event.key === 'Enter') openLightbox(9)"></div>
                </div>
            </div>
        </section>

        <!-- --- Lightbox --- -->
        <div id="lightbox" class="lightbox-container">
            <span class="close-btn" onclick="closeLightbox()">&times;</span>
            <div class="lightbox-content">
                <!-- 1-9: Grid Images (Synced Order) -->
                <div class="lightbox-slide"><img src="IMAGES/ingresso_09.webp" alt="Dettaglio ingresso"></div>
                <div class="lightbox-slide"><img src="IMAGES/camera_letto_03.webp" alt="Camera da letto"></div>
                <div class="lightbox-slide"><img src="IMAGES/bagno_04.webp" alt="Dettaglio doccia"></div>
                <div class="lightbox-slide"><img src="IMAGES/bagno_01.webp" alt="Bagno moderno"></div>
                <div class="lightbox-slide"><img src="IMAGES/soggiorno_03.webp" alt="Area living"></div>
                <div class="lightbox-slide"><img src="IMAGES/camera_letto_06.webp" alt="Camera da letto"></div>
                <div class="lightbox-slide"><img src="IMAGES/soggiorno_04.webp" alt="Dettaglio soggiorno"></div>
                <div class="lightbox-slide"><img src="IMAGES/soggiorno_07.webp" alt="Arredamento soggiorno"></div>
                <div class="lightbox-slide"><img src="IMAGES/ingresso_02.webp" alt="Ingresso"></div>

                <!-- Others (Hidden from grid) -->
                <div class="lightbox-slide"><img src="IMAGES/soggiorno_01.webp" alt="Soggiorno"></div>
                <div class="lightbox-slide"><img src="IMAGES/camera_letto_01.webp" alt="Camera da letto"></div>
                <div class="lightbox-slide"><img src="IMAGES/ingresso_01.webp" alt="Ingresso"></div>
                <div class="lightbox-slide"><img src="IMAGES/camera_letto_05.webp" alt="Camera da letto"></div>
                <div class="lightbox-slide"><img src="IMAGES/bagno_02.webp" alt="Bagno"></div>
                <div class="lightbox-slide"><img src="IMAGES/soggiorno_02.webp" alt="Soggiorno"></div>
                <div class="lightbox-slide"><img src="IMAGES/soggiorno_05.webp" alt="Soggiorno"></div>
                <div class="lightbox-slide"><img src="IMAGES/soggiorno_06.webp" alt="Soggiorno"></div>
                <div class="lightbox-slide"><img src="IMAGES/soggiorno_08.webp" alt="Soggiorno"></div>
                <div class="lightbox-slide"><img src="IMAGES/soggiorno_10.webp" alt="Soggiorno"></div>
                <div class="lightbox-slide"><img src="IMAGES/soggiorno_11.webp" alt="Soggiorno"></div>

                <div class="lightbox-slide"><img src="IMAGES/camera_letto_02.webp" alt="Camera da letto"></div>
                <div class="lightbox-slide"><img src="IMAGES/camera_letto_04.webp" alt="Camera da letto"></div>
                <div class="lightbox-slide"><img src="IMAGES/camera_letto_07.webp" alt="Camera da letto"></div>
                <div class="lightbox-slide"><img src="IMAGES/camera_letto_08.webp" alt="Camera da letto"></div>
                <div class="lightbox-slide"><img src="IMAGES/camera_letto_09.webp" alt="Camera da letto"></div>
                <div class="lightbox-slide"><img src="IMAGES/camera_letto_10.webp" alt="Camera da letto"></div>

                <div class="lightbox-slide"><img src="IMAGES/bagno_03.webp" alt="Bagno"></div>
                <div class="lightbox-slide"><img src="IMAGES/bagno_05.webp" alt="Bagno"></div>
                <div class="lightbox-slide"><img src="IMAGES/bagno_08.webp" alt="Bagno"></div>
                <div class="lightbox-slide"><img src="IMAGES/bagno_11.webp" alt="Bagno"></div>

                <div class="lightbox-slide"><img src="IMAGES/ingresso_03.webp" alt="Ingresso"></div>
                <div class="lightbox-slide"><img src="IMAGES/ingresso_04.webp" alt="Ingresso"></div>
                <div class="lightbox-slide"><img src="IMAGES/ingresso_07.webp" alt="Ingresso"></div>
                <div class="lightbox-slide"><img src="IMAGES/ingresso_10.webp" alt="Ingresso"></div>

                <a class="prev-btn" onclick="changeSlide(-1)">&#10094;</a>
                <a class="next-btn" onclick="changeSlide(1)">&#10095;</a>
            </div>
            <!-- Dots removed for cleaner look with many images, or can be re-added dynamically if strictly needed. Keeping simple 1/N counter logic is often better for large galleries, but keeping code simple here. -->
            <div class="dots-container" style="display:none;"></div>
        </div>

        <!-- --- Location Section --- -->
        <section id="location" class="content-section section-updated">
            <div class="container">
                <h2 class="section-title">
                    <span data-lang="it">Posizione Strategica</span>
                    <span data-lang="en">Strategic Location</span>
                </h2>
                <div class="location-grid">
                    <!-- Left Column: Points of Interest -->
                    <div class="card">
                        <h3>
                            <span data-lang="it">Punti di Interesse</span>
                            <span data-lang="en">Points of Interest</span>
                        </h3>
                        <ul>
                            <li><span data-lang="it">A pochi passi da fermate bus per il centro, Porta Susa, Porta
                                    Nuova, e ospedali</span><span data-lang="en">Steps from public transport to city
                                    center, Porta Susa, Porta Nuova, hospitals</span></li>
                            <li><span data-lang="it">500 m dal Santuario di Santa Rita</span><span data-lang="en">500 m
                                    from the Sanctuary of Santa Rita</span></li>
                            <li><span data-lang="it">1,1 km dallo Stadio Olimpico Grande Torino</span><span
                                    data-lang="en">1.1 km from Stadio Olimpico Grande Torino</span></li>
                            <li><span data-lang="it">1,3 km dall’Inalpi Arena <strong>(ATP Finals
                                        2026)</strong></span><span data-lang="en">1.3 km from
                                    Inalpi Arena <strong>(ATP Finals 2026)</strong></span></li>
                            <li><span data-lang="it">1,4 km dal Parco Cavalieri di Vittorio Veneto (Piazza
                                    d’Armi)</span><span data-lang="en">1.4 km from Parco Cavalieri di Vittorio
                                    Veneto
                                    (Piazza d’Armi)</span></li>
                        </ul>
                        <a href="explore.html" class="cta-button read-more-btn cta-secondary">
                            <span data-lang="it">Leggi di più</span>
                            <span data-lang="en">Read More</span>
                        </a>
                    </div>

                    <!-- Right Column: Map -->
                    <div class="map-wrapper">
                        <iframe src="https://www.google.com/maps/d/embed?mid=1jvb2a5NvnJ6g5aDpuVON8M70sRc0Euw"
                            width="100%" height="100%" style="border:0; min-height: 350px;" allowfullscreen=""
                            loading="lazy"></iframe>
                        <a href="https://www.google.com/maps/dir/?api=1&destination=Via+Mombarcaro+47+Torino"
                            target="_blank" rel="noopener noreferrer" class="map-cta-mobile">
                            <span data-lang="it">Apri in Maps</span>
                            <span data-lang="en">Open in Maps</span>
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <!-- --- Prices Section REMOVED (Hidden for now) --- -->
        <!--
        <section id="prices" class="content-section">
            <div class="container">
                <h2 class="section-title">
                    <span data-lang="it">Prezzi</span>
                    <span data-lang="en">Prices</span>
                </h2>
                <div class="grid grid-centered">
                    <div class="card">
                        <h3>
                            <span data-lang="it">Intero Appartamento – € 115 a notte</span>
                            <span data-lang="en">Entire Apartment – €115 per night</span>
                        </h3>
                        <p>
                            <span data-lang="it">L'appartamento può ospitare comodamente <strong>fino a 3
                                    persone</strong>: dispone di una camera da letto matrimoniale e di un divano
                                letto
                                nel soggiorno.</span>
                            <span data-lang="en">The apartment comfortably accommodates <strong>up to 3
                                    guests</strong>,
                                with a double bedroom and a sofa bed in the living room.</span>
                        </p>
                    </div>
                </div>
            </div>
        </section>
        -->

        <!-- --- Check-in/Check-out Section --- -->
        <section id="checkin-checkout" class="content-section" style="background-color: var(--light-gray);">
            <div class="container">
                <h2 class="section-title">
                    <span data-lang="it">Check-in e Check-out</span>
                    <span data-lang="en">Check-in and Check-out</span>
                </h2>
                <div class="grid">
                    <div class="card">
                        <h3><span data-lang="it">Check-in</span><span data-lang="en">Check-in</span></h3>
                        <p><span data-lang="it">Entro le ore 16</span><span data-lang="en">By 4:00 PM</span></p>
                    </div>
                    <div class="card">
                        <h3><span data-lang="it">Check-out</span><span data-lang="en">Check-out</span></h3>
                        <p><span data-lang="it">Entro le ore 12</span><span data-lang="en">By 12:00 PM</span></p>
                    </div>
                    <div class="card">
                        <h3><span data-lang="it">Orari Flessibili</span><span data-lang="en">Flexible Times</span>
                        </h3>
                        <p><span data-lang="it">(Possibilità di orari flessibili su richiesta)</span><span
                                data-lang="en">(Flexible times available on request)</span></p>
                    </div>
                </div>
            </div>
        </section>

        <!-- --- Parking Section --- -->
        <section id="parking" class="content-section">
            <div class="container">
                <h2 class="section-title">
                    <span data-lang="it">Parcheggio</span>
                    <span data-lang="en">Parking</span>
                </h2>
                <p class="intro-text">
                    <span data-lang="it">Non disponibile, ma facilmente accessibile nelle vicinanze.</span>
                    <span data-lang="en">Not available, but easy to find nearby.</span>
                </p>
            </div>
        </section>

        <!-- --- Services Section --- -->
        <section id="services" class="content-section" style="background-color: var(--light-gray);">
            <div class="container">
                <h2 class="section-title">
                    <span data-lang="it">Servizi</span>
                    <span data-lang="en">Services</span>
                </h2>
                <div class="grid grid-centered">
                    <div class="card">
                        <ul>
                            <li><span data-lang="it">Wi-Fi</span><span data-lang="en">Wi-Fi</span></li>
                            <li><span data-lang="it">Biancheria da letto e bagno</span><span data-lang="en">Bed
                                    linen
                                    and towels</span></li>
                            <li><span data-lang="it">Ricevuta disponibile</span><span data-lang="en">Receipt
                                    available</span></li>
                        </ul>
                    </div>
                    <div class="card">
                        <ul>
                            <li><span data-lang="it">Pagamento con bonifico, carta di credito, bancomat o
                                    contanti</span><span data-lang="en">Payment via bank transfer, credit/debit card or
                                    cash</span></li>
                            <li><span data-lang="it">Quota di soggiorno da versare in contanti in loco: € 3,80 al giorno
                                    a persona (dai 12 anni)</span><span data-lang="en">Tourist tax to be paid in cash on
                                    site: € 3.80 per day per person (from 12 years)</span></li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- --- Booking Section --- -->
        <section id="booking" class="content-section booking-section section-updated">
            <div class="container" style="text-align: center;">
                <h2 class="section-title">
                    <span data-lang="it">Prenota il Tuo Soggiorno</span>
                    <span data-lang="en">Book Your Stay</span>
                </h2>
                <p style="max-width: 600px; margin: 0 auto 2rem auto;">
                    <span data-lang="it">Vivi un'esperienza unica a Torino. Controlla la disponibilità e prenota ora
                        la
                        tua vacanza da sogno.</span>
                    <span data-lang="en">Live a unique experience in Turin. Check availability and book your dream
                        vacation now.</span>
                </p>
                <p style="text-align: center;">
                    <strong>
                        <span data-lang="it">Seleziona le date libere di tuo interesse e clicca "RICHIEDI INFO
                            ALL'HOST"<br>riceverai a breve la nostra conferma e le informazioni.</span>
                        <span data-lang="en">Select the available dates you are interested in and click "REQUEST INFO
                            FROM HOST"<br>you will soon receive our confirmation and the information.</span>
                    </strong>
                </p>
                <div class="calendar-nav">
                    <button onclick="cambiaMese(-1)" aria-label="Mese precedente"><i
                            class="fas fa-chevron-left"></i></button>
                    <button onclick="cambiaMese(1)" aria-label="Mese successivo"><i
                            class="fas fa-chevron-right"></i></button>
                </div>
                <div id="calendari-container" class="calendar-updated"></div>
                <div class="cta-buttons-grid">
                    <!-- Left: Booking (Secondary) -->
                    <a href="https://www.booking.com/Share-LTBz0G" target="_blank" class="cta-button cta-booking">
                        <span data-lang="it">Prenota su Booking</span>
                        <span data-lang="en">Book on Booking</span>
                    </a>
                    <!-- Right: Direct (Primary) -->
                    <button onclick="generaEmail()" class="cta-button cta-button-red cta-direct" id="btn-prenota"
                        disabled>
                        <span data-lang="it">RICHIEDI INFO ALL'HOST<br><span class="btn-subtitle">(selezionare prima le
                                date)</span></span>
                        <span data-lang="en">REQUEST INFO FROM HOST<br><span class="btn-subtitle">(select dates
                                first)</span></span>
                    </button>
                </div>
            </div>
        </section>
    </main>

    <div id="booking-feedback"></div>



    <!-- --- Footer --- -->
    <footer>
        <div class="container footer-content">
            <div class="footer-copyright">
                <p>
                    <span data-lang="it">Serendipity Casa Vacanze &copy; 2026. Tutti i diritti riservati.</span>
                    <span data-lang="en">Serendipity Holiday Home &copy; 2026. All rights reserved.</span>
                </p>
                <p class="footer-info">CF GNRLNZ02L12C722B | CIR 00127209054 | CIN: IT001272C28EJX3D2Q</p>
            </div>
            <div class="footer-social">
                <a href="https://www.instagram.com/serendipitycasavacanze" target="_blank" rel="noopener noreferrer"
                    aria-label="Instagram" class="instagram-link">
                    <i class="fab fa-instagram"></i>
                </a>
            </div>
            <div class="footer-policy">
                <a href="privacy_policy.html"><span data-lang="it">Privacy Policy</span><span data-lang="en">Privacy
                        Policy</span></a>
                <a href="cookie_policy.html"><span data-lang="it">Cookies Policy</span><span data-lang="en">Cookies
                        Policy</span></a>
            </div>
        </div>
    </footer>

    <script>
        const urlCSV = "https://docs.google.com/spreadsheets/d/1y1zN6TsGKDHXr7fdOCkbH3IXMouSuefamQvHtpxASOw/gviz/tq?tqx=out:csv";
        let disponibilita = {};
        let meseCorrente = new Date().getMonth();
        let annoCorrente = new Date().getFullYear();
        let dateSelezionate = [];
        const emailProprietario = 'serendipityholidayhome.torino@gmail.com';

        function caricaDati(callback) {
            fetch(urlCSV)
                .then(r => r.text())
                .then(text => {
                    const righe = text.trim().split("\n").slice(1); // salta intestazione
                    righe.forEach(riga => {
                        const [data, stato] = riga.split(",");
                        if (data && stato) { // Aggiunto controllo per righe vuote
                            const [gg, mm, aaaa] = data.trim().split("/"); // formato DD/MM/YYYY
                            const dataISO = `${aaaa}-${mm.padStart(2, "0")}-${gg.padStart(2, "0")}`;
                            disponibilita[dataISO] = stato.trim().toLowerCase();
                        }
                    });
                    callback();
                })
                .catch(error => {
                    console.error("Impossibile caricare i dati di disponibilità. Il calendario verrà mostrato comunque.", error);
                    callback(); // Mostra il calendario anche in caso di errore
                });
        }

        function generaCalendario(mese, anno) {
            const lang = document.documentElement.lang || 'it';
            const locale = lang === 'it' ? 'it-IT' : 'en-US';

            const meseNome = new Date(anno, mese).toLocaleString(locale, { month: 'long' });
            const titolo = `${meseNome.charAt(0).toUpperCase() + meseNome.slice(1)} ${anno}`;

            const wrapper = document.createElement("div");
            wrapper.className = "mese";

            const h3 = document.createElement("h3");
            h3.textContent = titolo;
            wrapper.appendChild(h3);

            const griglia = document.createElement("div");
            griglia.className = "calendar-grid";

            const giorniSettimanaIT = ['Dom', 'Lun', 'Mar', 'Mer', 'Gio', 'Ven', 'Sab'];
            const giorniSettimanaEN = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const giorniSettimana = lang === 'it' ? giorniSettimanaIT : giorniSettimanaEN;

            for (let g of giorniSettimana) {
                const el = document.createElement("div");
                el.className = "day-name";
                el.textContent = g;
                griglia.appendChild(el);
            }

            let offset = new Date(anno, mese, 1).getDay();
            for (let i = 0; i < offset; i++) {
                const vuoto = document.createElement("div");
                vuoto.className = "day vuoto";
                griglia.appendChild(vuoto);
            }

            const oggi = new Date().toISOString().split('T')[0]; // Data attuale in ISO

            for (let giorno = 1; giorno <= new Date(anno, mese + 1, 0).getDate(); giorno++) {
                const data = `${anno}-${String(mese + 1).padStart(2, '0')}-${String(giorno).padStart(2, '0')}`;
                const stato = disponibilita[data] || "libero";
                const cella = document.createElement("div");
                cella.className = "day";
                cella.dataset.data = data; // Salva la data ISO per facile accesso
                cella.setAttribute('tabindex', '0'); // Make focusable
                cella.setAttribute('role', 'button'); // Screen readers know it's clickable

                if (stato === "libero") cella.classList.add("libero");
                if (stato === "occupato") cella.classList.add("occupato");

                // Check for past dates
                if (data < oggi) {
                    cella.classList.add("passato");
                    cella.classList.remove("libero"); // Ensure past days are not marked as free
                }

                cella.innerHTML = `<small>${giorno}</small>`;

                // Aggiungi onclick solo se libero e non passata
                if (stato === "libero" && data >= oggi) {
                    cella.onclick = function () {
                        this.classList.toggle('selected');
                        if (this.classList.contains('selected')) {
                            dateSelezionate.push(data);
                        } else {
                            dateSelezionate = dateSelezionate.filter(d => d !== data);
                        }
                        updateUI(); // Update UI on click
                    };
                    // Add keyboard support (Enter or Space)
                    cella.addEventListener('keydown', function (e) {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault(); // Prevent scrolling on Space
                            this.click();
                        }
                    });
                }


                // Riapplica selected se è nell'array
                if (dateSelezionate.includes(data)) {
                    cella.classList.add('selected');
                }

                griglia.appendChild(cella);
            }

            wrapper.appendChild(griglia);
            return wrapper;
        }

        function updateUI() {
            const btnPrenota = document.getElementById('btn-prenota');
            const feedback = document.getElementById('booking-feedback');
            const lang = document.documentElement.lang || 'it';

            // Update Button State
            if (dateSelezionate.length > 0) {
                btnPrenota.disabled = false;
                btnPrenota.classList.remove('disabled');
            } else {
                btnPrenota.disabled = true;
                btnPrenota.classList.add('disabled');
            }

            // Update Feedback Element
            if (dateSelezionate.length > 0) {
                const nightText = lang === 'it' ? 'notte' : 'night';
                const nightsText = lang === 'it' ? 'notti' : 'nights';
                const selectedText = lang === 'it' ? 'selezionate' : 'selected';

                let countText = dateSelezionate.length === 1 ? nightText : nightsText;
                feedback.textContent = `${dateSelezionate.length} ${countText} ${selectedText}`;
                feedback.classList.add('visible');
            } else {
                feedback.classList.remove('visible');
            }
        }

        function mostraCalendari() {
            const contenitore = document.getElementById("calendari-container");
            contenitore.innerHTML = "";
            contenitore.appendChild(generaCalendario(meseCorrente, annoCorrente));
            let mese2 = meseCorrente + 1;
            let anno2 = annoCorrente;
            if (mese2 > 11) {
                mese2 = 0;
                anno2++;
            }
            contenitore.appendChild(generaCalendario(mese2, anno2));
            updateUI(); // Run on calendar refresh/init
        }

        function cambiaMese(delta) {
            meseCorrente += delta;
            if (meseCorrente > 11) {
                meseCorrente = 0;
                annoCorrente++;
            } else if (meseCorrente < 0) {
                meseCorrente = 11;
                annoCorrente--;
            }
            mostraCalendari();
        }

        function generaEmail() {
            if (dateSelezionate.length === 0) {
                return; // Should be handled by disabled button, but safety check
            }

            // Ordina le date
            dateSelezionate.sort();

            // Check for contiguous dates
            // Convert to timestamps for easy comparison
            const timestamps = dateSelezionate.map(d => new Date(d).getTime());
            let isContiguous = true;
            const oneDay = 24 * 60 * 60 * 1000;

            for (let i = 0; i < timestamps.length - 1; i++) {
                if (timestamps[i + 1] - timestamps[i] !== oneDay) {
                    isContiguous = false;
                    break;
                }
            }

            const lang = document.documentElement.lang;

            if (!isContiguous) {
                const msg = lang === 'it'
                    ? 'Per favore, seleziona date consecutive per il tuo soggiorno.'
                    : 'Please select consecutive dates for your stay.';
                alert(msg);
                return;
            }

            const subject = lang === 'it' ? 'Interesse per prenotazione Serendipity' : 'Interest in booking Serendipity';
            const body = lang === 'it'
                ? `Buongiorno,
vorrei prenotare la vostra struttura per le seguenti date (anno-mese-giorno): ${dateSelezionate.join(', ')}.
Attendo una vostra comunicazione di conferma ed il link per il pagamento tramite carta di credito.`
                : `Hello, I am interested in booking for the following dates: ${dateSelezionate.join(', ')}. Contact me for confirmation and payment.`;

            const mailto = `mailto:${emailProprietario}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            window.location.href = mailto;
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Intersection Observer for animations
            const sections = document.querySelectorAll('.content-section');
            const observer = new IntersectionObserver(entries => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                        observer.unobserve(entry.target);
                    }
                });
            }, {
                threshold: 0.1
            });
            sections.forEach(section => {
                observer.observe(section);
            });

            // Hamburger menu
            const hamburger = document.querySelector('.hamburger');
            const navLinks = document.querySelector('.nav-links');
            const navOverlay = document.querySelector('.nav-overlay');

            function toggleMenu() {
                hamburger.classList.toggle('toggle');
                navLinks.classList.toggle('active');
                navOverlay.classList.toggle('active');
                document.body.style.overflow = navLinks.classList.contains('active') ? 'hidden' : '';
            }

            hamburger.addEventListener('click', toggleMenu);

            // Close menu when clicking overlay
            navOverlay.addEventListener('click', toggleMenu);

            // Close menu when clicking a link
            navLinks.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', toggleMenu);
            });

            // Language switcher
            const langItBtn = document.getElementById('lang-it');
            const langEnBtn = document.getElementById('lang-en');

            function setLanguage(lang) {
                document.documentElement.lang = lang;
                langItBtn.classList.toggle('active', lang === 'it');
                langEnBtn.classList.toggle('active', lang === 'en');
                mostraCalendari(); // Redraw calendar with new language
            }

            langItBtn.addEventListener('click', () => setLanguage('it'));
            langEnBtn.addEventListener('click', () => setLanguage('en'));

            // Set initial language based on the HTML lang attribute
            setLanguage(document.documentElement.lang);

            // Lightbox
            let slideIndex = 1;

            window.openLightbox = function (n) {
                document.getElementById("lightbox").style.display = "block";
                showSlides(slideIndex = n);
            }

            window.closeLightbox = function () {
                document.getElementById("lightbox").style.display = "none";
            }

            window.changeSlide = function (n) {
                showSlides(slideIndex += n);
            }

            window.currentSlide = function (n) {
                showSlides(slideIndex = n);
            }

            function showSlides(n) {
                let i;
                const slides = document.getElementsByClassName("lightbox-slide");
                const dots = document.getElementsByClassName("dot");
                if (n > slides.length) { slideIndex = 1 }
                if (n < 1) { slideIndex = slides.length }
                for (i = 0; i < slides.length; i++) {
                    slides[i].style.display = "none";
                }
                for (i = 0; i < dots.length; i++) {
                    dots[i].className = dots[i].className.replace(" active", "");
                }
                slides[slideIndex - 1].style.display = "block";
                if (dots.length > 0 && dots[slideIndex - 1]) {
                    dots[slideIndex - 1].className += " active";
                }
            }



            document.addEventListener('keydown', function (event) {
                if (event.key === "Escape") {
                    closeLightbox();
                }
                if (document.getElementById('lightbox').style.display === 'block') {
                    if (event.key === "ArrowLeft") changeSlide(-1);
                    if (event.key === "ArrowRight") changeSlide(1);
                }
            });

            // Swipe functionality for Lightbox
            const lightbox = document.getElementById('lightbox');
            let touchStartX = 0;
            let touchEndX = 0;

            lightbox.addEventListener('touchstart', e => {
                touchStartX = e.changedTouches[0].screenX;
            });

            lightbox.addEventListener('touchend', e => {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipeLightbox();
            });

            function handleSwipeLightbox() {
                if (touchEndX < touchStartX - 50) {
                    changeSlide(1); // Swipe Left -> Next
                }
                if (touchEndX > touchStartX + 50) {
                    changeSlide(-1); // Swipe Right -> Prev
                }
            }

            // Swipe functionality for Calendar
            const calendarContainer = document.getElementById('calendari-container');
            let calTouchStartX = 0;
            let calTouchEndX = 0;

            calendarContainer.addEventListener('touchstart', e => {
                calTouchStartX = e.changedTouches[0].screenX;
            });

            calendarContainer.addEventListener('touchend', e => {
                calTouchEndX = e.changedTouches[0].screenX;
                handleSwipeCalendar();
            });

            function handleSwipeCalendar() {
                // Swipe Left -> Next Month
                if (calTouchEndX < calTouchStartX - 50) {
                    cambiaMese(1);
                }
                // Swipe Right -> Prev Month
                if (calTouchEndX > calTouchStartX + 50) {
                    cambiaMese(-1);
                }
            }

            caricaDati(mostraCalendari);
        });
    </script>

    <script src="js/cookie-banner.js"></script>
</body>

</html>